<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org" layout:decorator="layout">
<head>
    <!-- Highcarts -->
    <script src="/js/highcharts/highcharts.js"></script>
    <script src="/js/highcharts/modules/data.js"></script>
</head>
<body>
    <div layout:fragment="content">
        <div id="results">
            <div class="summary">
                Run type: <span th:text="${runType}"></span>
            </div>
            <div th:object="${result}" class="parameter-optimization">
                <div class="program" th:each="dataConfig, dataConfigStat : *{dataConfigs}">
                    <span class="name">Data configuration: <span th:text="${dataConfig.name}"></span></span>
                    <div class="data-wrapper">
                        <div class="data" th:each="dataStatistic, dataStatisticStat : ${dataConfig.dataStatistics}">
                            <div class="dash"></div>
                            <div th:switch="${dataStatistic.name}">
                                <div th:case="IntraInterDistributionDataStatistic">
                                    <span class="name"><span th:text="${dataStatistic.alias}"></span></span></span>
                                    <div style="height: 500px;" th:class="${'intraInterSimilarityDistribution_' + dataConfig.name}" th:attr="data-statisticfile=${dataStatistic.filePath}"></div>

                                    <script th:inline="javascript">
                                        $(document).ready(function() {
                                            var statisticFile = $('.intraInterSimilarityDistribution_' + [[${dataConfig.name}]]).data('statisticfile');
                                            $.get("/data-statistics/getIntraInterSimilarityDistributionFile?file=" + statisticFile, function(csv) {
                                                // Chart options
                                                var options = {
                                                    chart: {
                                                        type: 'area',
                                                        zoomType: 'x'
                                                    },
                                                    title: {
                                                        text: 'Intra-/Inter Similarity Distribution'
                                                    },
                                                    xAxis: {
                                                        categories: []
                                                    },
                                                    yAxis: {
                                                        title: {
                                                            text: 'Probability'
                                                        }
                                                    },
                                                    series: []
                                                };


                                                //Custom parsing of csv file
                                                // Split the lines
                                                var lines = csv.split('\n');
                                                var firstLine = "";
                                                var firstLineItems = [];

                                                // Iterate over the lines and add categories or series
                                                var currentSeries = {
                                                    data: [],
                                                    name: "Intra"
                                                }
                                                $.each(lines, function(lineNo, line) {
                                                    if (lineNo == 0) {
                                                        firstLine = lines[0];
                                                        firstLineItems = firstLine.split(',');
                                                    } else {
                                                        if (line != "") {
                                                            var items = line.split(',');

                                                            $.each(items, function(itemNo, item) {
                                                                currentSeries.data.push([parseFloat(firstLineItems[itemNo]), parseFloat(items[itemNo])]);
                                                            });

                                                            options.series.push(currentSeries);

                                                            currentSeries = {
                                                                data: [],
                                                                name: "Inter"
                                                            }
                                                        }
                                                    }
                                                });

                                                // Create the chart
                                                $('.intraInterSimilarityDistribution_' + [[${dataConfig.name}]]).highcharts(options);
                                            });
                                        });
                                    </script>
                                </div>
                                <div th:case="SimilarityDistributionDataStatistic">
                                    <span class="name"><span th:text="${dataStatistic.alias}"></span></span></span>
                                    <div style="height: 500px;" th:class="${'similarityDistributionDataStatistic_' + dataConfig.name}" th:attr="data-statisticfile=${dataStatistic.filePath}"></div>

                                    <script th:inline="javascript">
                                        $(document).ready(function() {
                                            var statisticFile = $('.similarityDistributionDataStatistic_' + [[${dataConfig.name}]]).data('statisticfile');
                                            $.get("/data-statistics/getIntraInterSimilarityDistributionFile?file=" + statisticFile, function(csv) {
                                                // Chart options
                                                var options = {
                                                    chart: {
                                                        type: 'area',
                                                        zoomType: 'x'
                                                    },
                                                    title: {
                                                        text: 'Similarity Distribution'
                                                    },
                                                    xAxis: {
                                                        categories: []
                                                    },
                                                    yAxis: {
                                                        title: {
                                                            text: 'Probability'
                                                        }
                                                    },
                                                    series: []
                                                };


                                                //Custom parsing of csv file
                                                // Split the lines
                                                var lines = csv.split('\n');
                                                var firstLine = "";
                                                var firstLineItems = [];

                                                // Iterate over the lines and add categories or series
                                                var currentSeries = {
                                                    data: [],
                                                    name: "Similarity"
                                                }
                                                $.each(lines, function(lineNo, line) {
                                                    if (lineNo == 0) {
                                                        firstLine = lines[0];
                                                        firstLineItems = firstLine.split(',');
                                                    } else {
                                                        if (line != "") {
                                                            var items = line.split(',');

                                                            $.each(items, function(itemNo, item) {
                                                                currentSeries.data.push([parseFloat(firstLineItems[itemNo]), parseFloat(items[itemNo])]);
                                                            });

                                                            options.series.push(currentSeries);
                                                        }
                                                    }
                                                });

                                                // Create the chart
                                                $('.similarityDistributionDataStatistic_' + [[${dataConfig.name}]]).highcharts(options);
                                            });
                                        });
                                    </script>
                                </div>
                                <div th:case="ClassSizeDistributionDataStatistic">
                                    <span class="name"><span th:text="${dataStatistic.alias}"></span></span></span>
                                    <div style="height: 500px;" th:class="${'classSizeDistributionDataStatistic_' + dataConfig.name}" th:attr="data-value=${dataStatistic.value}"></div>

                                    <script th:inline="javascript">
                                        $(document).ready(function() {
                                            var statisticValue = $('.classSizeDistributionDataStatistic_' + [[${dataConfig.name}]]).data('value');
                                            // Chart options
                                            var options = {
                                                chart: {
                                                    type: 'column',
                                                    zoomType: 'x'
                                                },
                                                title: {
                                                    text: 'Class'
                                                },
                                                xAxis: {
                                                    categories: []
                                                },
                                                yAxis: {
                                                    title: {
                                                        text: 'Size'
                                                    }
                                                },
                                                series: []
                                            };

                                            // Iterate over the lines and add categories or series
                                            var currentSeries = {
                                                data: []
                                            }
                                            var items = statisticValue.split('\t');
                                            $.each(items, function(itemNo, item) {
                                                currentSeries.data.push(parseFloat(item));
                                                options.series.push(currentSeries);

                                                currentSeries = {
                                                    data: []
                                                }
                                            });

                                            // Create the chart
                                            $('.classSizeDistributionDataStatistic_' + [[${dataConfig.name}]]).highcharts(options);
                                        });
                                    </script>
                                </div>
                                <div th:case="*">
                                    <span class="name"><span th:text="${dataStatistic.alias}"></span></span>: <span th:text="${dataStatistic.value}"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
